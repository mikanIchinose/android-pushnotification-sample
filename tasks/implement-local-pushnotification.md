# ローカルプッシュ通知実装ガイド

## 概要
このドキュメントでは、Androidアプリにローカルプッシュ通知機能を実装するための詳細タスクを説明します。

## 実装タスク一覧

### 高優先度タスク

#### 1. AlarmManagerを使用したスケジュール通知の実装
- [ ] `AlarmManager`を使用して指定時間に通知をトリガー
- [ ] `PendingIntent`の作成と設定
- [ ] 正確なアラーム（`setExactAndAllowWhileIdle`）の実装
- [ ] バッテリー最適化への対応

#### 2. BroadcastReceiverクラスの作成と通知トリガー処理
- [ ] `BroadcastReceiver`を継承したクラスの作成
- [ ] アラームイベントの受信処理
- [ ] 通知データの取得と処理
- [ ] 通知表示の実行

#### 3. 通知チャンネルの作成（Android 8.0+対応）
- [ ] `NotificationChannel`の作成
- [ ] チャンネルの重要度設定
- [ ] チャンネルの説明とグループ設定
- [ ] Android 8.0未満との互換性対応

#### 4. NotificationManagerを使用した通知表示機能
- [ ] `NotificationCompat.Builder`を使用した通知構築
- [ ] 通知のタイトル、本文、アイコン設定
- [ ] アクション（タップ時の動作）設定
- [ ] 通知スタイル（BigText、BigPicture等）の適用

#### 5. 通知権限のリクエスト処理（Android 13+対応）
- [ ] `POST_NOTIFICATIONS`権限の確認
- [ ] 権限リクエストダイアログの表示
- [ ] 権限拒否時の代替処理
- [ ] 設定画面への誘導

#### 6. AndroidManifest.xmlの権限とレシーバー設定
- [ ] 必要な権限の宣言
- [ ] `BroadcastReceiver`の登録
- [ ] `WAKE_LOCK`権限の設定
- [ ] `SCHEDULE_EXACT_ALARM`権限の設定（Android 12+）

### 中優先度タスク

#### 7. 通知のスケジューリング用UIの追加
- [ ] 日時選択UI（DatePicker、TimePicker）
- [ ] 通知内容入力フォーム
- [ ] スケジュール済み通知の一覧表示
- [ ] 通知設定の保存・読み込み

#### 8. SharedPreferencesでスケジュール済み通知の管理
- [ ] 通知データのシリアライゼーション
- [ ] 通知IDの管理
- [ ] スケジュール状態の永続化
- [ ] データの暗号化（必要に応じて）

#### 9. 通知キャンセル機能の実装
- [ ] 個別通知のキャンセル
- [ ] 一括キャンセル機能
- [ ] `AlarmManager`からのアラーム削除
- [ ] UIでのキャンセル操作

#### 10. アプリ再起動時の通知スケジュール復元
- [ ] アプリ起動時の復元処理
- [ ] デバイス再起動後の復元
- [ ] `BOOT_COMPLETED`レシーバーの実装
- [ ] スケジュール整合性の確認

## 実装順序の推奨

1. **基盤機能**：タスク3, 4, 6（通知チャンネル、表示機能、Manifest設定）
2. **コア機能**：タスク1, 2（AlarmManager、BroadcastReceiver）
3. **権限処理**：タスク5（通知権限）
4. **UI・管理機能**：タスク7, 8, 9（UI、データ管理、キャンセル）
5. **復元機能**：タスク10（再起動時復元）

## 注意事項

- Android 12以降では`SCHEDULE_EXACT_ALARM`権限が必要
- バッテリー最適化の影響を考慮した実装が必要
- 通知権限はAndroid 13以降でランタイム権限となる
- デバイスの省電力モード対応も検討する